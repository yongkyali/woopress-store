!function(s){"use strict";var a={storeCountry:function(){a.getCountry().length||s.getJSON(woongkir_params.json.country_url,function(o){o.sort(function(o,e){return o.country_name>e.country_name?1:e.country_name>o.country_name?-1:0}),Lockr.set(woongkir_params.json.country_key,o)})},getCountry:function(o,e){var r=Lockr.get(woongkir_params.json.country_key);return r&&void 0!==r?o&&o===Object(o)?a.searchLocation(r,o,e):r:[]},storeProvince:function(){a.getProvince().length||s.getJSON(woongkir_params.json.province_url,function(o){o.sort(function(o,e){return o.province_name>e.province_name?1:e.province_name>o.province_name?-1:0}),Lockr.set(woongkir_params.json.province_key,o)})},getProvince:function(o,e){var r=Lockr.get(woongkir_params.json.province_key);return r&&void 0!==r?o&&o===Object(o)?a.searchLocation(r,o,e):r:[]},storeCity:function(){a.getCity().length||s.getJSON(woongkir_params.json.city_url,function(o){o.sort(function(o,e){return o.city_name>e.city_name?1:e.city_name>o.city_name?-1:0}),Lockr.set(woongkir_params.json.city_key,o)})},getCity:function(o,e){var r=Lockr.get(woongkir_params.json.city_key);return r&&void 0!==r?o&&o===Object(o)?a.searchLocation(r,o,e):r:[]},storeSubdistrict:function(){a.getSubdistrict().length||s.getJSON(woongkir_params.json.subdistrict_url,function(o){o.sort(function(o,e){return o.subdistrict_name>e.subdistrict_name?1:e.subdistrict_name>o.subdistrict_name?-1:0}),Lockr.set(woongkir_params.json.subdistrict_key,o)})},getSubdistrict:function(o,e){var r=Lockr.get(woongkir_params.json.subdistrict_key);return r&&void 0!==r?o&&o===Object(o)?a.searchLocation(r,o,e):r:[]},searchLocation:function(o,e,r){return"filter"===r?o.filter(function(o){return a.isLocationMatch(o,e)}):o.find(function(o){return a.isLocationMatch(o,e)})},isLocationMatch:function(o,e){var r=!0;for(var i in e)o.hasOwnProperty(i)&&String(o[i]).toLowerCase()===String(e[i]).toLowerCase()||(r=!1);return r}};a.storeCountry(),a.storeProvince(),a.storeCity(),a.storeSubdistrict();var g={init:function(){g.bindEvents(),g.maybeOpenModal()},bindEvents:function(){s(document.body).off("click",".wc-shipping-zone-method-settings"),s(document.body).on("click",".wc-shipping-zone-method-settings",function(o){s(document.body).off("wc_backbone_modal_loaded",g.loadForm),s(o.currentTarget).closest("tr").find(".wc-shipping-zone-method-type").text()===woongkir_params.method_title&&s(document.body).on("wc_backbone_modal_loaded",g.loadForm)}),s(document.body).off("wc_backbone_modal_loaded",g.sortCouries),s(document.body).on("wc_backbone_modal_loaded",g.sortCouries),s(document.body).off("change","#woocommerce_woongkir_origin_province",g.loadFormCity),s(document.body).on("change","#woocommerce_woongkir_origin_province",g.loadFormCity),s(document.body).off("change","#woocommerce_woongkir_origin_city",g.loadFormSubdistrict),s(document.body).on("change","#woocommerce_woongkir_origin_city",g.loadFormSubdistrict),s(document.body).off("change","#woocommerce_woongkir_account_type",g.highlightFeature),s(document.body).on("change","#woocommerce_woongkir_account_type",g.highlightFeature),s(document.body).off("change","#woocommerce_woongkir_account_type",g.toggleCouriersBox),s(document.body).on("change","#woocommerce_woongkir_account_type",g.toggleCouriersBox),s(document.body).off("change","#woocommerce_woongkir_account_type",g.toggleVolumetricConverter),s(document.body).on("change","#woocommerce_woongkir_account_type",g.toggleVolumetricConverter),s(document.body).off("change","#woocommerce_woongkir_volumetric_calculator",g.toggleVolumetricDivider),s(document.body).on("change","#woocommerce_woongkir_volumetric_calculator",g.toggleVolumetricDivider),s(document.body).off("change",".woongkir-account-type",g.selectAccountType),s(document.body).on("change",".woongkir-account-type",g.selectAccountType),s(document.body).off("change",".woongkir-service--bulk",g.selectServicesBulk),s(document.body).on("change",".woongkir-service--bulk",g.selectServicesBulk),s(document.body).off("change",".woongkir-service--single",g.selectServices),s(document.body).on("change",".woongkir-service--single",g.selectServices),s(document.body).off("click",".woongkir-couriers-toggle",g.toggleServicesItems),s(document.body).on("click",".woongkir-couriers-toggle",g.toggleServicesItems)},maybeOpenModal:function(){woongkir_params.show_settings&&setTimeout(function(){for(var o=!1,e=s(document).find(".wc-shipping-zone-method-type"),r=0;r<e.length;r++){var i=e[r];if(s(i).text()===woongkir_params.method_title)return s(i).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(o=!0)}o||(s(".wc-shipping-zone-add-method").trigger("click"),s('select[name="add_method_id"]').val(woongkir_params.method_id).trigger("change"))},300)},loadForm:function(){var o=a.getProvince(),e={data:[],placeholder:woongkir_params.text.placeholder.state};if(o.length)for(var r=0;r<o.length;r++)e.data.push({id:o[r].province_id,text:o[r].province});s("#woocommerce_woongkir_origin_province").selectWoo(e).trigger("change"),s("#woocommerce_woongkir_account_type").trigger("change")},loadFormCity:function(){var o={data:[],placeholder:woongkir_params.text.placeholder.city},e=s("#woocommerce_woongkir_origin_city").val(),r="",i=s("#woocommerce_woongkir_origin_province").val(),t=a.getProvince({province_id:i});if(t){var c=a.getCity({province_id:t.province_id},"filter");if(c)for(var n=0;n<c.length;n++)o.data.push({id:c[n].city_id,text:c[n].type+" "+c[n].city_name}),e===c[n].city_id&&(r=c[n].city_id)}s("#woocommerce_woongkir_origin_city").selectWoo(o).val(r).trigger("change"),s("#woocommerce_woongkir_volumetric_calculator").trigger("change")},loadFormSubdistrict:function(){var o={data:[],placeholder:woongkir_params.text.placeholder.address_2},e=s("#woocommerce_woongkir_origin_subdistrict").val(),r="",i=s("#woocommerce_woongkir_origin_city").val(),t=a.getCity({city_id:i});if(t){var c=a.getSubdistrict({city_id:t.city_id},"filter");if(c)for(var n=0;n<c.length;n++)o.data.push({id:c[n].subdistrict_id,text:c[n].subdistrict_name}),e===c[n].subdistrict_id&&(r=c[n].subdistrict_id)}s("#woocommerce_woongkir_origin_subdistrict").selectWoo(o).val(r).trigger("change")},selectAccountType:function(o){o.preventDefault();var e=s(this).val();s(this).closest("tr").find("input").not(s(this)).prop("disabled",!1).prop("checked",!1),s(this).prop("disabled",!0),s("#woocommerce_woongkir_account_type").val(e).trigger("change")},highlightFeature:function(o){var e=s(o.currentTarget).val();s("#woongkir-account-features").find("td, th").removeClass("selected"),s("#woongkir-account-features").find(".woongkir-account-features-col-"+e).addClass("selected")},toggleVolumetricConverter:function(o){var e=s("#woocommerce_woongkir_account_type").data("accounts")[s(o.currentTarget).val()]||!1;e&&(e.volumetric?s("#woocommerce_woongkir_volumetric_calculator").trigger("change").closest("tr").show():s("#woocommerce_woongkir_volumetric_calculator, #woocommerce_woongkir_volumetric_divider").closest("tr").hide())},toggleVolumetricDivider:function(o){s(o.currentTarget).is(":checked")?s("#woocommerce_woongkir_volumetric_divider").closest("tr").show():s("#woocommerce_woongkir_volumetric_divider").closest("tr").hide()},toggleCouriersBox:function(){var o=s("#woocommerce_woongkir_account_type"),t=o.data("accounts"),c=o.data("couriers"),n=o.val();_.each(c,function(o,r){var i=0,e=_.find(c[r],function(o){return-1!==o.account.indexOf(n)});_.each(o,function(o,e){-1===o.account.indexOf(n)?(s(".woongkir-couriers-item--"+r+"--"+e).hide(),s(".woongkir-couriers-item--"+r+"--"+e).find(".woongkir-service").prop("checked",!1)):s(".woongkir-couriers-item--"+r+"--"+e).show(),t[n].multiple_couriers||(i&&s(".woongkir-couriers-item--"+r+"--"+e).find(".woongkir-service").prop("checked",!1),s(".woongkir-couriers-item--"+r+"--"+e).find(".woongkir-service--single:checked").length&&i++),g.updateSelectedServicesCounter(".woongkir-couriers-item--"+r+"--"+e)}),e?s(".woongkir-couriers-wrap--"+r).removeClass("no-items"):s(".woongkir-couriers-wrap--"+r).addClass("no-items")}),1===s(".woongkir-couriers-wrap.no-items").length?s(".woongkir-couriers-wrap:not(.no-items)").addClass("full-width"):s(".woongkir-couriers-wrap").removeClass("full-width")},selectServicesBulk:function(){var o=s(this).closest(".woongkir-couriers-item").data("id"),e=s(this).closest(".woongkir-couriers-item").data("zone"),r=s("#woocommerce_woongkir_account_type"),i=r.val(),t=r.data("accounts");s(this).is(":checked")?(s(this).closest(".woongkir-couriers-item").find(".woongkir-service--single").prop("checked",!0),t[i].multiple_couriers||s(".woongkir-couriers-item").not(".woongkir-couriers-item--"+e+"--"+o).find(".woongkir-service").prop("checked",!1)):s(this).closest(".woongkir-couriers-item-inner").find(".woongkir-service--single").prop("checked",!1),g.updateSelectedServicesCounter(".woongkir-couriers-item--"+e+"--"+o)},selectServices:function(){var o=s(this).closest(".woongkir-couriers-item").data("id"),e=s(this).closest(".woongkir-couriers-item").data("zone"),r=s("#woocommerce_woongkir_account_type"),i=r.val(),t=r.data("accounts");s(this).is(":checked")?(s(this).closest(".woongkir-couriers-item").find(".woongkir-service--bulk").prop("checked",!0),t[i].multiple_couriers||s(".woongkir-couriers-item").not(".woongkir-couriers-item--"+e+"--"+o).each(function(o,e){s(e).find(".woongkir-service").prop("checked",!1)})):s(this).closest(".woongkir-services").find(".woongkir-service--single:checked").length||s(this).closest(".woongkir-couriers-item").find(".woongkir-service--bulk").prop("checked",!1),g.updateSelectedServicesCounter(".woongkir-couriers-item--"+e+"--"+o)},updateSelectedServicesCounter:function(o){var e=s(o).find(".woongkir-service--single:checked").length;s(o).find(".woongkir-couriers--selected").text(e)},toggleServicesItems:function(o){var r;s(o.currentTarget).closest(".woongkir-couriers-item-inner").find(".woongkir-services-item").each(function(o,e){r=s(e).is(":visible")?(s(e).slideUp("fast"),!1):(s(e).slideDown("fast"),!0)}),r?(s(o.currentTarget).find(".dashicons").toggleClass("dashicons-admin-generic dashicons-arrow-up-alt2"),s(o.currentTarget).closest(".woongkir-couriers-item-info").find(".woongkir-couriers-item-info-link").show()):(s(o.currentTarget).find(".dashicons").toggleClass("dashicons-arrow-up-alt2 dashicons-admin-generic"),s(o.currentTarget).closest(".woongkir-couriers-item-info").find(".woongkir-couriers-item-info-link").hide())},sortCouries:function(){s(".woongkir-couriers").sortable()}};s(document).ready(g.init)}(jQuery);