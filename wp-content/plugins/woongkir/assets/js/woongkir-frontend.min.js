!function(g){"use strict";var p={storeCountry:function(){p.getCountry().length||g.getJSON(woongkir_params.json.country_url,function(t){t.sort(function(t,e){return t.country_name>e.country_name?1:e.country_name>t.country_name?-1:0}),Lockr.set(woongkir_params.json.country_key,t)})},getCountry:function(t,e){var i=Lockr.get(woongkir_params.json.country_key);return i&&void 0!==i?t&&t===Object(t)?p.searchLocation(i,t,e):i:[]},storeProvince:function(){p.getProvince().length||g.getJSON(woongkir_params.json.province_url,function(t){t.sort(function(t,e){return t.province_name>e.province_name?1:e.province_name>t.province_name?-1:0}),Lockr.set(woongkir_params.json.province_key,t)})},getProvince:function(t,e){var i=Lockr.get(woongkir_params.json.province_key);return i&&void 0!==i?t&&t===Object(t)?p.searchLocation(i,t,e):i:[]},storeCity:function(){p.getCity().length||g.getJSON(woongkir_params.json.city_url,function(t){t.sort(function(t,e){return t.city_name>e.city_name?1:e.city_name>t.city_name?-1:0}),Lockr.set(woongkir_params.json.city_key,t)})},getCity:function(t,e){var i=Lockr.get(woongkir_params.json.city_key);return i&&void 0!==i?t&&t===Object(t)?p.searchLocation(i,t,e):i:[]},storeSubdistrict:function(){p.getSubdistrict().length||g.getJSON(woongkir_params.json.subdistrict_url,function(t){t.sort(function(t,e){return t.subdistrict_name>e.subdistrict_name?1:e.subdistrict_name>t.subdistrict_name?-1:0}),Lockr.set(woongkir_params.json.subdistrict_key,t)})},getSubdistrict:function(t,e){var i=Lockr.get(woongkir_params.json.subdistrict_key);return i&&void 0!==i?t&&t===Object(t)?p.searchLocation(i,t,e):i:[]},searchLocation:function(t,e,i){return"filter"===i?t.filter(function(t){return p.isLocationMatch(t,e)}):t.find(function(t){return p.isLocationMatch(t,e)})},isLocationMatch:function(t,e){var i=!0;for(var r in e)t.hasOwnProperty(r)&&String(t[r]).toLowerCase()===String(e[r]).toLowerCase()||(i=!1);return i}};p.storeCountry(),p.storeProvince(),p.storeCity(),p.storeSubdistrict();var v={init:function(){g(document.body).on("country_to_state_changed",function(){var r=v.getFields();g("select.country_to_state, input.country_to_state").each(function(){var t=g(this),e=t.attr("id").replace("_country",""),i=t.val();_.each(r,function(t){t.callback&&g("#"+e+"_"+t.suffix).off("change",t.callback)}),"ID"===i?(v.modifyForm(e),_.each(r,function(t){t.callback&&g("#"+e+"_"+t.suffix).on("change",t.callback)}),_.each(r,function(t){t.triggerEvent&&g("#"+e+"_"+t.suffix).trigger(t.triggerEvent)})):v.restoreForm(e)})})},onChangeStateField:function(t){var e=g(t.currentTarget),i=e.attr("id").replace("_state",""),r=e.val(),n=[],o=p.getProvince({code:r});if(o){var c=p.getCity({province_id:o.province_id},"filter");if(c)for(var a=0;a<c.length;a++){var s=c[a].type+" "+c[a].city_name;n.push({id:s,text:s})}}var u=g("#"+i+"_city").val();g("#"+i+"_city").empty().select2({width:"100%",data:n,placeholder:v.getFields({suffix:"city"}).placeholder}).val(u).trigger("change")},onChangeCityField:function(t){var e=g(t.currentTarget),i=e.attr("id").replace("_city",""),r=g("#"+i+"_state").val(),n=e.val(),o=[],c=p.getProvince({code:r});if(c&&n){var a=n.split(" ")[0],s=n.split(" ").splice(1).join(" "),u=p.getCity({type:a,city_name:s,province_id:c.province_id});if(u){var d=p.getSubdistrict({province_id:c.province_id,city_id:u.city_id},"filter");if(d)for(var f=0;f<d.length;f++)o.push({id:d[f].subdistrict_name,text:d[f].subdistrict_name})}}var l=g("#"+i+"_address_2").val();g("#"+i+"_address_2").empty().select2({width:"100%",data:o,placeholder:v.getFields({suffix:"address_2"}).placeholder}).val(l).trigger("change")},onChangeSubdistrictField:function(t){var e,i;e=g("#ship-to-different-address-checkbox").is(":checked"),("billing"===(i=g(t.currentTarget).attr("id").replace("_address_2",""))&&!e||"shipping"===i&&e)&&g(document.body).trigger("update_checkout")},modifyForm:function(c){_.each(v.getFields(),function(t){if(t.modifyForm){var e=g("#"+c+"_"+t.suffix);if(!e||!e.length){var i=g("#"+c+"_postcode_field");if(i&&i.length){var r=i.clone().attr({id:c+"_"+t.suffix+"_field"});r.find("input").attr({id:c+"_"+t.suffix,name:c+"_"+t.suffix,value:g("#"+c+"_"+t.suffix+"_dummy").val(),placeholder:t.placeholder||"","data-placeholder":t.placeholder||""}),i.before(r),e=r.find("input")}}if(e&&e.length){if(!e.is("select")){var n=e.val(),o=_.omit(v.getFieldAttributes(e),["type"]);e.replaceWith(g("<select></select>").attr(o).append(g('<option value="'+n+'">'+n+"</option>")))}(e=g("#"+c+"_"+t.suffix)).removeClass("input-text"),e.select2({width:"100%"})}}})},restoreForm:function(r){_.each(v.getFields(),function(t){if(t.modifyForm){var e=g("#"+r+"_"+t.suffix);if(e.is("select")){e.select2("destroy");var i=_.extend(v.getFieldAttributes(e),{type:"text"});e.replaceWith(g("<input>").attr(i)),(e=g("#"+r+"_"+t.suffix)).addClass("input-text"),"calc_shipping"===r&&"address_2"===t.suffix&&e.closest(".form-row").remove()}}})},getFields:function(t){var e=[{suffix:"state",callback:v.onChangeStateField,triggerEvent:"change"},{suffix:"city",callback:v.onChangeCityField,modifyForm:!0,placeholder:woongkir_params.text.placeholder.city},{suffix:"address_2",callback:v.onChangeSubdistrictField,modifyForm:!0,placeholder:woongkir_params.text.placeholder.address_2}];return t?_.find(e,t):e},getFieldAttributes:function(t){var i={};return g.each(t[0].attributes,function(t,e){i[e.name]=e.value}),i}};g(document.body).on("wc_address_i18n_ready",function(){v.init(),setTimeout(function(){g(document.body).trigger("country_to_state_changed")},100)})}(jQuery);